{% extends 'base.html' %}
{% block header %}
<!DOCTYPE html>
<html lang="zxx" class="no-js">

<head>
	<!-- Mobile Specific Meta -->
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<!-- Favicon-->
	<link rel="shortcut icon" href="img/fav.png">
	<!-- Author Meta -->
	<meta name="author" content="CodePixar">
	<!-- Meta Description -->
	<meta name="description" content="">
	<!-- Meta Keyword -->
	<meta name="keywords" content="">
	<!-- meta character set -->
	<meta charset="UTF-8">
	<!-- Site Title -->
	<title>Seat Selection</title>

	<!--
            CSS
            ============================================= -->
	<link rel="stylesheet" href="{{ url_for('static', filename='css/linearicons.css') }}">
	<link rel="stylesheet" href="{{ url_for('static', filename='css/owl.carousel.css') }}">
	<link rel="stylesheet" href="{{ url_for('static', filename='css/themify-icons.css') }}">
	<link rel="stylesheet" href="{{ url_for('static', filename='css/font-awesome.min.css') }}">
	<link rel="stylesheet" href="{{ url_for('static', filename='css/nice-select.css') }}">
	<link rel="stylesheet" href="{{ url_for('static', filename='css/nouislider.min.css') }}">
	<link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.css') }}">
	<link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
</head>
{% endblock %}

{% block content %}

	<!-- Start Banner Area -->
	<section class="banner-area organic-breadcrumb">
		<div class="container">
			<div class="breadcrumb-banner d-flex flex-wrap align-items-center justify-content-end">
				<div class="col-first">
					<h1>Seat Selection</h1>
					<nav class="d-flex align-items-center">
						<a href="index.html">Home<span class="lnr lnr-arrow-right"></span></a>
						<a href="category.html">Seat Selection</a>
					</nav>
				</div>
			</div>
		</div>
	</section>
	<!-- End Banner Area -->
	<!-- Start Sample Area -->
		<div class="container">
			<h3 class="text-heading">Availability</h3>
            <a href="#" class="genric-btn success circle e-large">Available</a>
            <a href="#" class="genric-btn danger circle e-large">Taken</a>
    </div>
  <!-- End Sample Area -->
  <!-- Start Button -->
  <section class="button-area">
        <div id = "displaySelectedSeats" class="container border-top-generic">
            <div id= "seatSlots" class="container border-top-generic">
                  <h3 class="text-heading">Select Seats</h3>
                    <img src="static/img/temp_screen.png" alt="">
            {% for ticket in tickets %}
            <!-- remove this comment to see the seats list -->
            <!-- <h2>{{ ticket }} </h2>-->
            {% endfor %}



            </div>
            <div id= "selectedSeats"><br>
                <h3>Selected Seats</h3>

            </div>
            <div>
                <br><br>
            <a href="/confirm_booking" class="genric-btn primary e-large arrow">Next <span class="lnr lnr-arrow-right"></span></a>
            </div>
        </div>
        <script>


            /**
             * Makes sure the HTML and CSS have been loaded
             * first before running any Javascript to stop
             * potential errors.
             */
            $(function(){

                var array = [""];
                var db = {};
                window.seatsArr = [];
                window.selectedUserSeats = {};
                window.valOfFilledSeat = -1;
                window.capacity = 0;
                window.rows = ["A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "K", "L", "M", "N", "O"];
                window.rowLength = 0;
                var newRow = "<div class='button-group-area mt-40'>\n";
                readJson(db);
                 /**
                 * Will load a hash map with all the JSON
                 * attributes and their cooresponding values.
                 */
                function readJson(db){

                    var seatInfo = JSON.parse('{{tickets | tojson | safe}}');
                    window.capacity = seatInfo.capacity;
                    var tempCap = window.capacity;
                    window.rowLength = seatInfo.row;
                    var rowSize = window.rowLength;
                    window.seatsArr = seatInfo.seats;
                    var rowNum = (tempCap % rowSize == 0) ? (tempCap / rowSize) : ((tempCap / rowSize) + 1);

                    for(var i = 0; i < rowNum && (tempCap > 0); i++){
                        var startSection = "<div class='button-group-area mt-40'> <button class='genric-btn default circle'>" + window.rows[i] + " Section</button>";
                        //$("#seatSlots").append(startSection);

                        for(var j = 0; j < rowSize && (tempCap > 0); j++){
                            if(window.seatsArr[(i * rowSize) + j] == window.valOfFilledSeat){
                                startSection += "<a href='' class='genric-btn danger circle'>" + window.rows[i]  + "" + (j+1) +"</a>";
                                tempCap--;
                               }
                            else {
                                startSection += "<button onclick='selectSeat("+ ((i * rowSize) + j) +")' class='genric-btn info circle'>" + window.rows[i]  + "" + (j+1) +"</button>";
                                tempCap--;
                            }
                        }
                        startSection += "<button class='genric-btn default circle'>" + window.rows[i] + " Section</button>";
                        $("#seatSlots").append(startSection);

                    }



                }//readJson


            });

            function selectSeat(seatNumber) {
                var stringName = "" + window.rows[Math.floor(seatNumber / window.rowLength)] + "" + ((seatNumber % window.rowLength) +1);
                var addPiece = "<div id='seat"+ seatNumber +"'> <p>Seat " + stringName + " </p><select name='"+seatNumber+"' required><option value='student'>Student</option><option value='child'>Child</option><option value='adult'>Adult</option><option value='senior'>Senior</option></select><t><button class='genric-btn danger circle' type='button' onclick='removeSeat("+ seatNumber +")'>Remove Seat!</button></div>";
                if(seatNumber == window.valOfFilledSeat){
                    // Nothing needs to be done. Seat Already Taken. Catch here just in case.
                }
                else if (selectedUserSeats[seatNumber] == null){

                     $("#selectedSeats").append(addPiece);
                    selectedUserSeats[seatNumber] = "Selected";
                }

            }//selectSeat

            function removeSeat(seatNumber) {
                console.log("Remove: " + seatNumber);
                if(selectedUserSeats[seatNumber] != null){
                    delete selectedUserSeats[seatNumber];
                    $(("#seat"+ seatNumber + "")).remove();
                }
            }
        </script>
  </section>
  <!-- End Button -->
  {% endblock %}
  {% block last %}

	<script src="{{ url_for('static', filename='js/vendor/jquery-2.2.4.min.js') }}"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4"
	 crossorigin="anonymous"></script>
	<script src="{{ url_for('static', filename='js/vendor/bootstrap.min.js') }}"></script>
	<script src="{{ url_for('static', filename='js/jquery.ajaxchimp.min.js') }}"></script>
	<script src="{{ url_for('static', filename='js/jquery.nice-select.min.js') }}"></script>
	<script src="{{ url_for('static', filename='js/jquery.sticky.js') }}"></script>
	<script src="{{ url_for('static', filename='js/nouislider.min.js') }}"></script>
	<script src="{{ url_for('static', filename='js/jquery.magnific-popup.min.js') }}"></script>
	<script src="{{ url_for('static', filename='js/owl.carousel.min.js') }}"></script>
	<!--gmaps Js-->
	<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCjCGmQ0Uq4exrzdcL6rvxywDDOvfAu6eE"></script>
	<script src="{{ url_for('static', filename='js/gmaps.min.js') }}"></script>
	<script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>

</html>
{% endblock %}
